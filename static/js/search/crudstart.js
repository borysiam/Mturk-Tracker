// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    var hgcs;
    hgcs = new mtracker.search.model.HitGroupContentSearch;
    return hgcs.fetchMeta(function(meta) {
      var fV, hgcTable;
      hgcTable = new mtracker.search.view.HitGroupContentSearchTable({
        el: $('#hitgroupcontent-table'),
        meta: meta,
        collection: hgcs
      });
      hgcTable.removeWidget('.crud-meta-actions', 'crud.view.SelectAllWidget');
      hgcTable.removeWidget('.crud-meta-actions', 'crud.view.SelectNoneWidget');
      hgcTable.addWidget('.crud-meta-actions', 'crud.view.SorterSelect');
      hgcTable.render();
      hgcs.fetch();
      meta.filterGroups[1].filterGroupClass = mtracker.search.view.MultiSelectFilterGroup;
      meta.filterGroups[2].filterGroupClass = mtracker.search.view.MultiSelectFilterGroup;
      fV = new mtracker.search.view.FilterList({
        collection: hgcs,
        filterGroups: meta.filterGroups,
        filterGroupClass: mtracker.search.view.HorizontalFilterGroup
      });
      $(".filter-bar").append(fV.render().el);
      return $(".chzn-select").chosen().change(function(e) {
        var key, vals;
        vals = $(e.target).val();
        if (vals) {
          key = vals[0].split(':', 1)[0];
        } else {
          key = $(e.target).children('option')[0].value;
        }
        hgcs.removeFilterByKey(key.split(':', 1)[0]);
        _.each(vals, function(filter) {
          return hgcs.addFilter(filter);
        });
        return hgcs.fetch();
      });
    });
  });

}).call(this);
