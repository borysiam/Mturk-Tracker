<dataConfig>
    <dataSource name="mturk_crawl"
                driver="org.postgresql.Driver"
                url="jdbc:postgresql://localhost/%(db_name)s"
                user="%(solr_db_user)s"
                password="%(solr_db_password)s"
                readOnly="true"
                autoCommit="false"
                maxRows="0"
                transactionIsolation="TRANSACTION_READ_COMMITTED"
                holdability="CLOSE_CURSORS_AT_COMMIT"/>
    <document>
        <entity name="hitgroupcontent" dataSource="mturk_crawl" threads="2"
                transformer="HTMLStripTransformer" 
                query="
                    SELECT 
                        hgcnt.id as django_id, 
                        hgcnt.group_id,
                        hgcnt.requester_id, 
                        hgcnt.requester_name,
                        hgcnt.reward,
                        hgcnt.html, 
                        hgcnt.description, 
                        hgcnt.title, 
                        hgcnt.keywords, 
                        hgcnt.qualifications, 
                        hgcnt.occurrence_date, 
                        hgcnt.time_alloted,
                        hgcls.classes
                    FROM
                        main_hitgroupcontent AS hgcnt
                    LEFT JOIN
                        main_requesterprofile AS rp
                        ON hgcnt.requester_id = rp.requester_id
                    LEFT JOIN
                        main_hitgroupclass AS hgcls
                        ON hgcnt.group_id = hgcls.group_id
                    WHERE
                        COALESCE(rp.is_public, true) = true AND
                        hgcnt.is_public = true AND
                        LENGTH(html) &lt; 9000001"

				deltaQuery="SELECT DISTINCT
                    hitgroupcontent_id as id
                FROM
                    main_indexqueue
				WHERE
                    created > '${dataimporter.last_index_time}'"

                deltaImportQuery="
                    SELECT 
                        hgcnt.id as django_id, 
                        hgcnt.group_id,
                        hgcnt.requester_id, 
                        hgcnt.requester_name,
                        hgcnt.reward,
                        hgcnt.html, 
                        hgcnt.description, 
                        hgcnt.title, 
                        hgcnt.keywords, 
                        hgcnt.qualifications, 
                        hgcnt.occurrence_date, 
                        hgcnt.time_alloted,
                        hgcls.classes
                    FROM
                        main_hitgroupcontent AS hgcnt
                    LEFT JOIN
                        main_requesterprofile AS rp
                        ON hgcnt.requester_id = rp.requester_id
                    LEFT JOIN
                        main_hitgroupclass AS hgcls
                        ON hgcnt.group_id = hgcls.group_id
                    WHERE
                        COALESCE(rp.is_public, true) = true AND
                        hgcnt.is_public = true AND 
                        hgcnt.id = ${dataimporter.delta.id}">

            <field column="django_id" name="django_id" />
            <field column="group_id" name="group_id"/>
            <field column="requester_id" name="requester_id"/>
            <field column="requester_name" name="requester_name"/>
            <field column="reward" name="reward"/>
            <field column="html" name="content" stripHTML="true"/>
            <field column="description" name="description" stripHTML="true"/>
            <field column="title" name="title"/>
            <field column="keywords" name="keywords" splitBy="," />
            <field column="qualifications" name="qualifications"/>
            <field column="occurrence_date" name="occurrence_date"/>
            <field column="time_alloted" name="time_alloted"/>
            <field column="classes" name="classes"/>

		</entity>

    </document>
</dataConfig>
